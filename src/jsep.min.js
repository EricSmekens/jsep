//     JavaScript Expression Parser (JSEP) <%= version %>
//     JSEP may be freely distributed under the MIT License
//     http://jsep.from.so/

!function(e){"use strict";var r="Compound",t="MemberExpression",n="Literal",o=function(e,r){var t=new Error(e+" at character "+r);throw t.index=r,t.description=e,t},i={"-":!0,"!":!0,"~":!0,"+":!0},a={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},u=function(e){var r,t=0;for(var n in e)(r=n.length)>t&&e.hasOwnProperty(n)&&(t=r);return t},s=u(i),p=u(a),f={true:!0,false:!1,null:null},c=function(e){return a[e]||0},l=function(e,r,t){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:r,right:t}},d=function(e){return e>=48&&e<=57},h=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!a[String.fromCharCode(e)]},v=function(e){for(var u,v,x=0,y=e.charAt,m=e.charCodeAt,b=function(r){return y.call(e,r)},g=function(r){return m.call(e,r)},E=e.length,w=function(){for(var e=g(x);32===e||9===e||10===e||13===e;)e=g(++x)},C=function(){var e,r,t=U();return w(),63!==g(x)?t:(x++,(e=C())||o("Expected expression",x),w(),58===g(x)?(x++,(r=C())||o("Expected expression",x),{type:"ConditionalExpression",test:t,consequent:e,alternate:r}):void o("Expected :",x))},O=function(){w();for(var r=e.substr(x,p),t=r.length;t>0;){if(a.hasOwnProperty(r))return x+=t,r;r=r.substr(0,--t)}return!1},U=function(){var e,r,t,n,i,a,u,s;if(a=k(),!(r=O()))return a;for(i={value:r,prec:c(r)},(u=k())||o("Expected expression after "+r,x),n=[a,i,u];(r=O())&&0!==(t=c(r));){for(i={value:r,prec:t};n.length>2&&t<=n[n.length-2].prec;)u=n.pop(),r=n.pop().value,a=n.pop(),e=l(r,a,u),n.push(e);(e=k())||o("Expected expression after "+r,x),n.push(i,e)}for(e=n[s=n.length-1];s>1;)e=l(n[s-1].value,n[s-2],e),s-=2;return e},k=function(){var r,t,n;if(w(),r=g(x),d(r)||46===r)return j();if(39===r||34===r)return A();if(91===r)return M();for(n=(t=e.substr(x,s)).length;n>0;){if(i.hasOwnProperty(t))return x+=n,{type:"UnaryExpression",operator:t,argument:k(),prefix:!0};t=t.substr(0,--n)}return!(!h(r)&&40!==r)&&L()},j=function(){for(var e,r,t="";d(g(x));)t+=b(x++);if(46===g(x))for(t+=b(x++);d(g(x));)t+=b(x++);if("e"===(e=b(x))||"E"===e){for(t+=b(x++),"+"!==(e=b(x))&&"-"!==e||(t+=b(x++));d(g(x));)t+=b(x++);d(g(x-1))||o("Expected exponent ("+t+b(x)+")",x)}return r=g(x),h(r)?o("Variable names cannot start with a number ("+t+b(x)+")",x):46===r&&o("Unexpected period",x),{type:n,value:parseFloat(t),raw:t}},A=function(){for(var e,r="",t=b(x++),i=!1;x<E;){if((e=b(x++))===t){i=!0;break}if("\\"===e)switch(e=b(x++)){case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:r+=e}else r+=e}return i||o('Unclosed quote after "'+r+'"',x),{type:n,value:r,raw:t+r+t}},P=function(){var r,t,i=g(x),u=x;for(h(i)?x++:o("Unexpected "+b(x),x);x<E&&(i=g(x),36===(t=i)||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!a[String.fromCharCode(t)]);)x++;return r=e.slice(u,x),f.hasOwnProperty(r)?{type:n,value:f[r],raw:r}:"this"===r?{type:"ThisExpression"}:{type:"Identifier",name:r}},S=function(e){for(var t,n,i=[],a=!1;x<E;){if(w(),(t=g(x))===e){a=!0,x++;break}44===t?x++:((n=C())&&n.type!==r||o("Expected comma",x),i.push(n))}return a||o("Expected "+String.fromCharCode(e),x),i},L=function(){var e,r;for(r=40===(e=g(x))?B():P(),w(),e=g(x);46===e||91===e||40===e;)x++,46===e?(w(),r={type:t,computed:!1,object:r,property:P()}):91===e?(r={type:t,computed:!0,object:r,property:C()},w(),93!==(e=g(x))&&o("Unclosed [",x),x++):40===e&&(r={type:"CallExpression",arguments:S(41),callee:r}),w(),e=g(x);return r},B=function(){x++;var e=C();if(w(),41===g(x))return x++,e;o("Unclosed (",x)},M=function(){return x++,{type:"ArrayExpression",elements:S(93)}},q=[];x<E;)59===(u=g(x))||44===u?x++:(v=C())?q.push(v):x<E&&o('Unexpected "'+b(x)+'"',x);return 1===q.length?q[0]:{type:r,body:q}};if(v.version="<%= version %>",v.toString=function(){return"JavaScript Expression Parser (JSEP) v"+v.version},v.addUnaryOp=function(e){return s=Math.max(e.length,s),i[e]=!0,this},v.addBinaryOp=function(e,r){return p=Math.max(e.length,p),a[e]=r,this},v.addLiteral=function(e,r){return f[e]=r,this},v.removeUnaryOp=function(e){return delete i[e],e.length===s&&(s=u(i)),this},v.removeAllUnaryOps=function(){return i={},s=0,this},v.removeBinaryOp=function(e){return delete a[e],e.length===p&&(p=u(a)),this},v.removeAllBinaryOps=function(){return a={},p=0,this},v.removeLiteral=function(e){return delete f[e],this},v.removeAllLiterals=function(){return f={},this},"undefined"==typeof exports){var x=e.jsep;e.jsep=v,v.noConflict=function(){return e.jsep===v&&(e.jsep=x),v}}else"undefined"!=typeof module&&module.exports?exports=module.exports=v:exports.parse=v}(this);
